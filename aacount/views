from django.shortcuts import render, redirect
from django.db import models
from .models import compte
from django import forms
from .forms import compte_utilisateur_form, userloginform, userregisterform
from django.urls import path
from .inscription_connection import *
from django.contrib.auth import authenticate,get_user_model,login,logout
from django.contrib.auth import login as lo 



def mon_compte(request):
    return render(request, 'pages/mon_compte.html')

def logout(request):
    pass

def loginn(request):
    print("blablabla")

    a = request.POST.get('username')
    b = request.POST.get('password')
    print(a)
    print(b)
    form = userloginform(request.POST or None)
 
    if form.is_valid():
        print("validddddddddddddddddddddddd")
        username = form.cleaned_data.get('username')
        password = form.cleaned_data.get('password')
        loggin(username, password)
    
        
    return render(request, 'pages/login.html')





def register(request):

    next = request.GET.get('next')
    form = userregisterform(request.POST or None)
    
    if form.is_valid():
        print("ouiiiiiiiiiii")
        user = form.save(commit=False)
        password = form.cleaned_data.get('password')
        user.set_password(password)
        user.save()
        new_user = authenticate(username=user.username, password=password)
        lo(request, new_user)
        print("OKI DOCKIIIIIIIIIIIIIIIIIIIIIIIII")
        if next:
            return redirect(next)
        return redirect("/")

    
    context = {
        'form':form,

        }
    
        
    return render(request, 'pages/inscription.html', context)

def logout(request):
    logout(request)
    return redirect('/')



def inscription(request):

    
    form = compte_utilisateur_form(request.POST or None)
    print(form)
    if form.is_valid():
        print("okiokioki")
        nom = form.cleaned_data['nom']
        password = form.cleaned_data['password']
        email = form.cleaned_data['email']

        print("COUCOUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU")
        envoi = True


        if request.method == "POST":
            print("ohouiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii")
            email = request.POST.get('email')
            alita = inscription_email(email)
     
            form = compte_utilisateur_form(request.POST)

            
            if form.is_valid() and alita == []:
                
                nom = request.POST.get('nom')
                password = request.POST.get('password')
                email = request.POST.get('email')
            
                oobject = compte(nom=nom,
                                 
                                 password=password,
                                 email=email)
                oobject.save()

                return render(request, 'home.html',locals())
                #page recap inscription


            else:

                message="addresse mail deja utilisé"
                return render(request, 'pages/inscription.html', locals(), {'message':message})
                
    print("oyééééééééééééé")
    return render(request, 'pages/inscription.html',locals())






def contact(request):
    
    pass






















    

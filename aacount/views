from django.shortcuts import render, redirect
from django.db import models
from .models import compte
from django import forms
from .forms import compte_utilisateur_form, userloginform, userregisterform
from django.urls import path
from .inscription_connection import *
from django.contrib.auth import authenticate,get_user_model,login,logout
from django.contrib.auth import login as lo 



def mon_compte(request):
    return render(request, 'pages/mon_compte.html')

def logout(request):
    pass

def loginn(request):

    next = request.GET.get('next')
    form = userloginform(request.POST or None)
    
    if form.is_valid():
        
        username = form.cleaned_data.get('username')
        password = form.cleaned_data.get('password')
        user = authenticate(username=username, password=password)

        lo(request, user)
        
        if next:
            return redirect(next)
        return redirect("/")

    
    context = {
        'form':form,

        }
    
        
    return render(request, 'pages/login.html', context)






def register(request):
    pass



























def inscription(request):

    
    form = compte_utilisateur_form(request.POST or None)
    
    if form.is_valid():
        
        nom = form.cleaned_data['nom']
        prenom = form.cleaned_data['prenom']
        password = form.cleaned_data['password']

        email = form.cleaned_data['email']

        addresse = form.cleaned_data['addresse']
        ville = form.cleaned_data['ville']
        code_postale = form.cleaned_data['code_postale']

        sexe = form.cleaned_data['sexe']
        date = form.cleaned_data['date']
        statut = form.cleaned_data['statut']

        envoi = True


        if request.method == "POST":

            email = request.POST.get('email')
            alita = inscription_email(email)
     
            form = compte_utilisateur_form(request.POST)

            
            if form.is_valid() and alita == []:
                
                nom = request.POST.get('nom')
                prenom = request.POST.get('prenom')
                password = request.POST.get('password')
                email = request.POST.get('email')
                addresse = request.POST.get('addresse')
                ville = request.POST.get('ville')
                code_postale = request.POST.get('code_postale')
                sexe = request.POST.get('sexe')
                date = request.POST.get('date')
                statut = request.POST.get('statut')

        
                oobject = compte(nom=nom,
                                 prenom=prenom,
                                 password=password,
                                 email=email,
                                 addresse=addresse,
                                 ville=ville,
                                 code_postale=code_postale,
                                 sexe=sexe,
                                 date=date,
                                 statut=statut)
                oobject.save()

                return render(request, 'pages/inscription.html',locals())
                #page recap inscription


            else:

                message="addresse mail deja utilis√©"
                return render(request, 'pages/inscription.html', locals(), {'message':message})
                
            
    return render(request, 'pages/inscription.html',locals())






def contact(request):
    
    pass






















    
